name: Daily Tech News Fetcher # 工作流名称

on:
  schedule:
    # 使用 CRON 表达式设定在每天 UTC 时间 0 点 (即北京时间早上 8 点) 运行
    # 格式: 秒(0-59) 分钟(0-59) 小时(0-23) 日期(1-31) 月份(1-12) 星期几(0-6, 0 or 7 是 Sunday)
    # 注意：GitHub Actions 使用的是 UTC 时间，北京时间 = UTC + 8 小时
    # 所以北京时间 8:00 AM 对应 UTC 0:00 AM
    - cron: '0 0 * * *'
  # 允许手动在 GitHub 网页上触发此工作流，方便测试
  workflow_dispatch:

jobs:
  fetch-and-send:
    runs-on: ubuntu-latest # 在最新的 Ubuntu 环境中运行

    steps:
    - name: Checkout Repository # 步骤1：检出仓库代码
      uses: actions/checkout@v4

    - name: Set up Python # 步骤2：设置 Python 环境
      uses: actions/setup-python@v5
      with:
        python-version: '3.x' # 使用最新的 Python 3.x 版本

    - name: Install Dependencies # 步骤3：安装 Python 依赖 (如果有的话，例如 requests)
      run: |
        python -m pip install --upgrade pip
        pip install requests beautifulsoup4 feedparser

    - name: Run Python Script # 步骤4：运行你的 Python 脚本
      env:
        SERVER_CHAN_SENDKEY: ${{ secrets.SERVER_CHAN_SENDKEY }} # 将 GitHub Secrets 注入为环境变量
      run: |
        python .github/scripts/fetch_and_push.py
